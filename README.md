# Backend API для системы опросов пользователей
Тестовое задание для компании Фабрика Решений

## Использованные технологии
- Python 3.9
- Django 2.2.10
- Django REST Framework 3.13.1
- SQLite3 (дефолтная база данных Django, использована для простоты установки и запуска проекта)
- uuid 1.30

## Инструкция по установке и запуску
```
git clone https://github.com/die-kreatur/fr_test_assignment.git
cd fr_test_assignment
python -m venv env
env\Scripts\activate
pip install -r requirements.txt
cd service
python manage.py makemigrations api
python manage.py migrate
python manage.py createsuperuser # создание администратора, этот шаг можно пропустить
python manage.py runserver
```
Django REST Framework предоставляет графический интерфейс в браузере для отправки запросов к api и получения данных с сервера.

## Детали реализации
### Система администратора
Фреймворк Django предоставляет готовый функционал для панели администратора, поэтому нет необходимости реализовывать то, что уже реализовано. Для того, чтобы администратор мог удалять, создавать и обновлять вопросы и опросы, достаточно создать соответствующие модели и зарегистрировать их в модуле **admin.py**.

### Пользовательская система
- Пользователи могут проходить опросы анонимно, и их ответы будут сохраняться в базу данных. Для этого каждому новому пользователю присваевается уникальный идентификатор, сгенерерированный с помощью библиотки **python uuid**. Пользователь считается новым, если начинается новая сессия. Uid пользователя сохраняется в словарь **request.session** (скрипт в файле **middlewares.py**), откуда его можно получить в случае необходимости.
- На каждый вопрос пользователь может ответить только один раз. В случае попытки ответить снова, пользователю будет возвращено сообщение об ошибке и невозможности это сделать.
- Опрос считается активным, если дата его окончания еще не наступила.

## Использование API
- При отправке GET запроса к http://127.0.0.1:8000/api/active-quizes пользовутелю будет возвращены данные об активных опросах в формате:
```
[
    {
        "name": "Quiz name",
        "start": "yyyy-mm-dd",
        "end": "yyyy-mm-dd"
    }
]
```

Чтобы получить данные о конкретном вопросе и ответить на него, нужно отправить GET запрос к http://127.0.0.1:8000/api/questions/id, где id - это числовой идентификатор вопроса. Если вопрос существует, пользователь получит ответ в формате:
```
{
    "quiz": 1,
    "question": "What is the capital of Italy?",
    "type": "text answer"
}
```
Если вопроса с указанным идентификатором не существует, вернется сооьбщение об ошибке:
```
{
    "Error": "Question number 10 does not exist"
}
```

Чтобы дать ответ на вопрос, нужно к тому же url отправить POST запрос с данными в следующем формате:
```
{
    "answer": "Rome"
}
```
Uid пользователя, вопрос и опрос будут добавлены и сохранены вместе с ответом автоматически. Если пользователь уже отвечал на вопрос, он получит сообщение об ошибке:
```
{
    "Error": "You have already answered this question"
}
```
При отправке GET запроса к http://127.0.0.1:8000/api/answers/ пользователю будут возвращены его ответы на вопросы с идентификаторами вопроса и опроса
```
[
    {
        "quiz": 1,
        "question": 1,
        "answer": "Rome"
    }
]
```
